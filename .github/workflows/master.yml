name: Andre Actions
run-name: ${{ github.actor }} GitHub Actions 
on:
  push:
    branches:
      - 'master'

jobs:
  ClonagemRepo:
    runs-on: self-hosted
    steps: 
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          path: '/home/g6bank/actions-runner/_work/G6/G6'

  CheckDotnet:
    runs-on: self-hosted
    needs: [ClonagemRepo]
    steps:
      - name: Check .NET Core SDK
        run: |
          cd /home/g6bank
          if ! command -v dotnet &> /dev/null
          then
              echo ".NET Core SDK is not installed. Installing..."
              ./dotnet-install.sh --channel 8.0
              source ~/.bashrc
          else
              echo ".NET Core SDK is installed."
          fi

  Build:
    runs-on: self-hosted
    needs: [ClonagemRepo, CheckDotnet]
    steps: 
      - name: Setup envs
        run: |
          cd /home/g6bank/actions-runner/_work/G6/G6
          git pull origin master

      - name: Build project
        run: |
          cd /home/g6bank/actions-runner/_work/G6/G6
          dotnet build

  Deploy:
    runs-on: self-hosted
    needs: [Build]
    steps:
      - name: Run project
        run: |
          cd /home/g6bank/actions-runner/_work/G6/G6/G6.Api/bin/Debug/net8.0
          pm2 restart meuAppDotNet
